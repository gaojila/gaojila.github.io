# VictoriaMetrics实现Prometheus高可用


## 背景
非容器下prometheus高可用体系调研
| 参数             | 联邦                                                         | Thanos                                                                   | VictoraMetrics                                                                                |
|------------------|--------------------------------------------------------------|--------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| 长期存储         | 小于一个月                                                   | 永久（对象存储）                                                         | 俩个月（可用本地盘存储）                                                                      |
| grafana配置      | 联邦节点，有oom风险                                          | query，长期存储读storegateway，短期读本都盘（指标过多未拆分时有oom风险） | vmselect，不使用prometheus，使用vmagent采集数据，比prometheus内存消耗更小，数据查询读vmselect |
| prometheus多副本 | 依赖亲和或standby机制，一般只有一个副本提供数据，service亲和 | 支持去重（副本重启数据不会断）                                           | 支持去重（副本重启数据不会断）                                                                |
| 部署             | 简单                                                         | 复杂                                                                     | 简单                                                                                          |
| 资源使用         | 多                                                           | 最多                                                                     | 较多                                                                                          |

## VictoraMetrics 架构
![架构图](https://viewer.diagrams.net/?highlight=0000ff&edit=_blank&layers=1&nav=1&title=victoria#R7Vxbc6M2FP41PKYjJMTl0Um8u91Lp510m%2FZRMYrNBiMvyIndX19hhDES8SUGi9j1%2BMEchIDzne%2FcpLGFbqaLjymZTb6xkMYWBOHCQrcWhLYDoZV%2FQbgsJJ4rBeM0CuWgSnAX%2FUulEEjpPAppVhvIGYt5NKsLRyxJ6IjXZCRN2Ut92COL63edkTHVBHcjEuvS%2Byjkk0LqQ6%2BSf6LReFLe2XaD4syUlIPlm2QTErKXDREaWugmZYwXv6aLGxrnyiv1cv%2Fr8j7%2B%2BuR%2B%2FPxH9pN8v%2F7y529%2FXRWTfTjkkvUrpDThb576i%2FM0Qu7w86fhiCyiH9nzt%2B9XV7acO%2BPLUmE0FPqThyzlEzZmCYmHlfQ6ZfMkpPm0QBxVY74yNhNCWwh%2FUM6X0hjInDMhmvBpLM8W98xvpGC04wXLh2XzdES3vJUEjJN0TPm2t69gFPZP2ZTydCkuTGlMePRcfzoiDXG8HicvHaQpWW4MmLEo4dnGzL%2FnAjFAcmpNDcko6CvAKeMx3jpe%2FCieoDzaeJVKtDKGQwwDXrJhBEfaxQY2h6seeZesetwHStrudko6ztbx3VBS3vKZxHOphuepiF4Jv9KdeGUOObYvk4jTuxlZAfQi4nwd%2Bscojm9YzNLVtSj0AfCQkGc8ZU9048wAA%2BDk9vXIEr4hf1x91kb0TFNOF28wIx32chbFBdrSBYKXKqTbZZyebIRziUv7JLWxCZIKHabLv%2FPrf8Hl4T9yutXB7aJ2tJRHXZO7TOw6D7jHOVb%2FHB3rK8w5zGHu9nBQYVKBtbxKAaaN%2FONVZ6cnJmfm7JDfO2dnJCPpq7ND78PZBX3CzH4nmBnJPl33HWSf6FWHjM7dIbugbw4Za2AkLKQ5gxYzwVqatgqJ%2FUBsCpsgAcAdDj70IEa6phGBRvolfQ2Rwb4h8thGy5v8LVKqfQcc1oBTxnfjbwOd4uMoWbRc6wPgEwCaqY09YMLbQkXbCBrnNtB0fg51495dct8ESXeQ7lBSd0NSqLPxoizDaJ%2B8fEzNRbbbIeihi3SC3rlIT8PiLJnh78kMiPqQ2GBnu89cL203j%2B%2FIZ55nF3Zvy3Deg2WoLYbTWIaRllV%2FLMNI8%2BlQy1CbVSexjFKHte5TlGQisrZcEFE08puj%2FTUIcFO0B6vPCQsiB5uO9ug80959uxZmiKoWRP0kqt62WBO13bS8h0RV03LzRIVNXfuMM2HgLftNF5DA9prggLeea6RKslUCYGwaDud1ONplRw%2FhUFv2PYBDX0ZZw9HuolYP4VAXtczDgVwNDj3NiONoltHDAEhYQrs0bDXO6or07QZF%2Bl0p0jHSe%2Bnr0n9Zye5M6wr7M11%2Fubsqc4S3je8mrSt1WPeUNKajtuuvBzLyw8blf4gcB4cnrLNc44vKjh6FLpnI%2B%2B4yNUNktT7rJ5Gb9lVKIrebgRokslqH9YDIZ9nzdlppZe8kknfirceOXqVdyNYLlTieZ5w47lkSB%2B8ZyZxWNvcfm5J6%2BLD9Ucr4jiJZr%2FakG8%2BN9rYoo5vSnYaNq5fhWtXiwrxrxXpNZ0E3Fre9fhA%2FxnyljUKQa6sGj%2FtzzsoTV9mKLQMxQKhpUZ0sZwmTzBr61sCzBsgaulYwtPJAU0wtnr2YvX5HId54ildtA%2FSqE2Sr%2B3KADvI6xm6CbIPOUNYT%2Fv9RPhbleuHmNSzznBplfZ3nHPMmDPeMcvjYvOk4NKCGxjgljyQh7dl4HrNIGIS4KcoR6tgInnAtJ0DdRTNxWP3HSpE9Vv9Ug4b%2FAQ%3D%3D) 

